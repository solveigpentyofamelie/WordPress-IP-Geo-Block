/*
 Project: WP-ZEP - Zero-day exploit Prevention for wp-admin
 Copyright (c) 2015-2016 tokkonopapa (tokkonopapa@yahoo.com)
 This software is released under the MIT License.
*/
var IP_GEO_BLOCK_ZEP={init:!1,auth:"ip-geo-block-auth-nonce",nonce:IP_GEO_BLOCK_AUTH.nonce||"",redirect:function(e){-1!==location.href.indexOf(e)&&(this.nonce&&(e+=(0<=e.indexOf("?")?"&":"?")+this.auth+"="+this.nonce),window.location.href=e)}};(function(e,r){function t(a){return a?a.toString().replace(/[&<>"']/g,function(a){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[a]}):""}function g(a){a=a?a.toString():"";a=a.match(/^(?:([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return{scheme:a[1]||"",relative:a[2]||"",authority:a[3]||"",path:a[4]||"",query:a[5]||"",fragment:a[6]||""}}function h(a,c){"object"!==typeof a&&(a=g(a||location.href));for(var b=a.query?a.query.split("&"):[],d=b.length;0<d--;)if(0===b[d].indexOf(IP_GEO_BLOCK_ZEP.auth)){b.splice(d,1);break}b.push(IP_GEO_BLOCK_ZEP.auth+"="+encodeURIComponent(c));a.query=b.join("&");return(a.scheme?a.scheme+":":"")+(a.relative+a.path)+(a.query?"?"+a.query:"")+(a.fragment?"#"+a.fragment:"")}function k(a){a=g(a?a.toString().toLowerCase():location.pathname);var c,b=a,d=[];"object"!==typeof b&&(b=g(b));b=b.path;"/"!==b.charAt(0)&&(c=window.location.pathname,b=c.substring(0,c.lastIndexOf("/")+1)+b);b=b.split("/");""===b[b.length-1]&&(b.pop(),b[b.length-1]+="/");for(c in b)b.hasOwnProperty(c)&&"."!==b[c]&&(".."===b[c]?0<d.length&&d.pop():(1>d.length||""!==b[c])&&d.push(b[c]));c=d.join("/").replace(/\/\//g,"/");if(/https?/.test(a.scheme)||!a.scheme){if(a.authority&&a.authority!==location.host.toLowerCase())return-1;if((a.scheme||a.path||a.query)&&u.test(c))return 1}return 0}function m(a,c,b){var d=c.split(/\s+/);a.each(function(a){for(a=0;a<d.length;a++){var c=e.trim(d[a]).match(/[^\.]+/i)[0],f=e(this),l=c,c=b,f=e._data(f[0]).events[l],l=c?f.splice(f.delegateCount-1,1)[0]:f.pop();f.splice(c?0:f.delegateCount||0,0,l)}})}function n(){var a=IP_GEO_BLOCK_ZEP.nonce;if(a){var c=e("body");c.find("img").each(function(b){b=e(this).attr("src");1===k(b)&&e(this).attr("src",h(b,a))});c.onFirst("click contextmenu","a",function(b){var c=e(this),d=c.attr("href"),f=c.attr("rel"),g="undefined"!==typeof d?k(d):0;if(1===g)c.attr("href",h(d,!f||0>f.indexOf("nofollow")?a:"nofollow"));else if(-1===g)return d=window.open(),d.document.write('<meta name="referrer" content="never" /><meta name="referrer" content="no-referrer" /><meta http-equiv="refresh" content="0; url='+t(this.href)+'" />'),d.document.close(),c.removeAttr("target"),c.off("click contextmenu"),b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation(),!1});c.onFirst("submit","form",function(b){b=e(this);var c=b.attr("action");1===k(c)&&b.attr("action",h(c,a))});if("undefined"!==typeof _wpRevisionsSettings)for(var b=_wpRevisionsSettings.revisionData,d=b.length,c=0;c<d;c++)-1===b[c].restoreUrl.indexOf(IP_GEO_BLOCK_ZEP.auth)&&(_wpRevisionsSettings.revisionData[c].restoreUrl=h(b[c].restoreUrl,a))}}var u=new RegExp("^(?:"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.admin+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.plugins+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.themes+")(?:.*.php|.*/)?$"),p=function(a){for(var c=a.length;0<c--;)if(-1!==a[c].indexOf("request%5Bbrowse%5D=ip-geo-block-auth")){a[c]="request%5Bbrowse%5D=featured";break}return a},q={"upload.php":function(a){for(var c=a.length;0<c--;)if(-1!==a[c].indexOf("query%5Bip-geo-block-auth-nonce%5D=")){delete a[c];break}return a},"theme-install.php":p,"network/theme-install.php":p};e(r).ajaxSend(function(a,c,b){if((a=IP_GEO_BLOCK_ZEP.nonce)&&1===k(b.url)&&!b.url.match(/async-upload\.php$/))if("undefined"!==typeof window.FormData&&b.data instanceof FormData)b.data.append(IP_GEO_BLOCK_ZEP.auth,a);else if(c=g(b.url),"undefined"===typeof b.data||c.query)b.url=h(c,a);else{c=b.data?b.data.split("&"):[];var d;d=location.pathname;d=d.replace(IP_GEO_BLOCK_AUTH.home+IP_GEO_BLOCK_AUTH.admin,"");(d=q.hasOwnProperty(d)?q[d]:null)&&(c=d(c));c.push(IP_GEO_BLOCK_ZEP.auth+"="+encodeURIComponent(a));b.data=c.join("&")}});"undefined"===typeof e.fn.onFirst&&(e.fn.onFirst=function(a,c){var b,d=e(this),f="string"===typeof c;e.fn.on.apply(d,arguments);if("object"===typeof a)for(b in a)a.hasOwnProperty(b)&&m(d,b,f);else"string"===typeof a&&m(d,a,f);return d});e(function(){e("a").each(function(){this.hasAttribute("onClick")||-1!==k(this.getAttribute("href"))||this.setAttribute("onClick","javascript:void(0);")});n();IP_GEO_BLOCK_ZEP.init=!0});e(window).on("error",function(){IP_GEO_BLOCK_ZEP.init||n()})})(jQuery,document);